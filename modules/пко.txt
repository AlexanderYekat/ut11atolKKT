//ВстариваниеВКонфуУТ11 2024
&НаКлиенте
процедура ЗавершениеПечатиЧекаРеальное(РезультатПечатиЧекаНаККТ, ДопПараметры) экспорт
	Перем ОписаниеОшибки;
	//ДопПараметры - пустые, не понятно какая информация может нам понадоится
	//Сообщить("ЗавершениеПечатиЧека с реузльатом" + СокрЛП(РезультатПечатиЧекаНаККТ));

	ОписаниеОшибки = "";
	резЗакрытияФормыПредваритПросмЧека = ИСТИНА;
	Если РезультатПечатиЧекаНаККТ = НЕОПРЕДЕЛЕНО тогда
		ОписаниеОшибки = "Печать чека отменена пользователем";
		резЗакрытияФормыПредваритПросмЧека = ЛОЖЬ;
	иначеЕсли Не РезультатПечатиЧекаНаККТ.Результат тогда
		резЗакрытияФормыПредваритПросмЧека = ЛОЖЬ;
		ОписаниеОшибки = РезультатПечатиЧекаНаККТ.ОписаниеОшибки;
	конецЕсли;
	Если резЗакрытияФормыПредваритПросмЧека Тогда
		// Установить полученное значение номера чека реквизиту документа.
		Объект.НомерЧекаККМ = РезультатПечатиЧекаНаККТ.НомерЧека;
		Модифицированность = Истина;
		Записать(Новый Структура("РежимЗаписи", РежимЗаписиДокумента.Проведение));
	Иначе
		ТекстСообщения = НСтр("ru = 'При печати чека произошла ошибка.
									|Чек не напечатан на фискальном регистраторе.
									|Дополнительное описание:
									|%ДополнительноеОписание%'");
		ТекстСообщения = СтрЗаменить(ТекстСообщения,
									 "%ДополнительноеОписание%",
									 ОписаниеОшибки);
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
	КонецЕсли;
конецПроцедуры //ЗавершениеПечатиЧека

&НаКлиенте
Процедура ПредложитьВыбратьУстройствоЗавершение(ИдентификаторУстройства, ДополнительныеПараметры) Экспорт
	
	Если ИдентификаторУстройства <> Неопределено Тогда
		
		ОписаниеОшибки = "";
		
		//Сообщить("Вставка кода для печти");
		//ВстариваниеВКонфуУТ11 2024
		//формаДокумента = ОткрытьФормуДокументаИзКоторогоБудетПечататьсяЧек();
		//скорее всего здесь надо вставить ссылку на процедуру обработки результата пеачти чека в модуле документа
   		ОповещениеПриЗавершенииПечатиЧека = Новый ОписаниеОповещения("ЗавершениеПечатиЧекаРеальное", ЭтотОбъект);
		Если ПодключаемоеОборудованиеУниверсальныйДрайверКлиент.ПечатьВызватьКомандуНаККТВместоВстроеннойВКонфигурацию(
				"ПечатьЧека", ОповещениеПриЗавершенииПечатиЧека, ЭтаФорма, Объект.Ссылка)
		тогда
			//Сообщить("Вставка кода для печти --");
			Возврат; //
		конецЕсли;
		//ВстариваниеВКонфуУТ11 2024 --		
